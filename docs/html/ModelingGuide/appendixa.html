<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>10. Appendix A &mdash; Modeling Guide</title>
    
    <link rel="stylesheet" href="_static/vortex.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.5.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Modeling Guide" href="index.html" />
    <link rel="next" title="11. Appendix B" href="appendixb.html" />
    <link rel="prev" title="9. Tutorial" href="tutorial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="appendixb.html" title="11. Appendix B"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="9. Tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Modeling Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="appendix-a">
<span id="id1"></span><h1>10. Appendix A<a class="headerlink" href="#appendix-a" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="_images/icon-java.png"><img alt="java" src="_images/icon-java.png" style="height: 6mm;" /></a></p>
<p>This appendix contains the example, user-written Java source code
included with the Vortex OpenSplice Modeler <tt class="docutils literal"><span class="pre">Chatroom</span></tt> example.
The Chatroom system is the example used in the
<a class="reference internal" href="tutorial.html#tutorial"><em>Tutorial</em></a>.</p>
<p>The source code is given in the following order:</p>
<blockquote>
<div><p><a class="reference internal" href="#chatter-application">Chatter Application</a></p>
<p><a class="reference internal" href="#messageboard-application">MessageBoard Application</a></p>
<p><a class="reference internal" href="#userload-application">UserLoad Application</a></p>
<p><a class="reference internal" href="#error-handler">Error Handler</a></p>
</div></blockquote>
<div class="section" id="a-chatroom-example-java-source-code">
<span id="appx-a-java"></span><span id="id2"></span><h2>10.1. A Chatroom Example, Java Source Code<a class="headerlink" href="#a-chatroom-example-java-source-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="chatter-application">
<h3>10.1.1. Chatter Application<a class="headerlink" href="#chatter-application" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ChatterApplication</span><span class="o">.</span><span class="na">java</span>

<span class="cm">/*******************************************************************************</span>
<span class="cm"> * Copyright (c) 2012 to 2016 PrismTech Ltd. All rights Reserved.</span>
<span class="cm"> * LOGICAL_NAME: ChatterApplication.java</span>
<span class="cm"> * FUNCTION:     Vortex OpenSplice Modeler Tutorial example code.</span>
<span class="cm"> * MODULE:       Tutorial for the Java programming language.</span>
<span class="cm"> * DATE:         January 2012.</span>
<span class="cm"> * ***********************************************************************</span>
<span class="cm"> * This file contains the implementation for the &#39;Chatter&#39; executable.</span>
<span class="cm"> ******************************************************************************/</span>

<span class="kn">package</span> <span class="nn">Chat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">Chat.ChatMessage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.ChatMessageDataWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NameService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NameServiceDataWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.ChatterApplicationWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.ChatterApplicationWrapper.WrapperException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.HANDLE_NIL</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChatterApplication</span>
<span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">NUM_MSG</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TERMINATION_MESSAGE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
   <span class="o">{</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="cm">/* Initialize the application */</span>
         <span class="n">ChatterApplicationWrapper</span><span class="o">.</span><span class="na">start</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error while starting the application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="cm">/* Type-specific DDS entities */</span>
      <span class="n">ChatMessageDataWriter</span> <span class="n">talker</span> <span class="o">=</span>
            <span class="n">ChatterApplicationWrapper</span><span class="o">.</span><span class="na">ParticipantWrapper</span><span class="o">.</span><span class="na">PublisherWrapper</span><span class="o">.</span>
            <span class="n">ChatMessageDataWriterWrapper</span>
            <span class="o">.</span><span class="na">getDataWriter</span> <span class="o">();</span>

      <span class="n">NameServiceDataWriter</span> <span class="n">nameServer</span> <span class="o">=</span>
            <span class="n">ChatterApplicationWrapper</span><span class="o">.</span><span class="na">ParticipantWrapper</span><span class="o">.</span><span class="na">PublisherWrapper</span><span class="o">.</span>
            <span class="n">NameServiceDataWriterWrapper</span>
            <span class="o">.</span><span class="na">getDataWriter</span> <span class="o">();</span>

      <span class="cm">/* DDS Identifiers */</span>
      <span class="kt">long</span> <span class="n">userHandle</span><span class="o">;</span>
      <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>

      <span class="cm">/* Sample definitions */</span>
      <span class="n">ChatMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ChatMessage</span> <span class="o">();</span>
      <span class="n">NameService</span> <span class="n">ns</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NameService</span> <span class="o">();</span>

      <span class="cm">/* Others */</span>
      <span class="kt">int</span> <span class="n">ownID</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
      <span class="n">String</span> <span class="n">chatterName</span><span class="o">;</span>

      <span class="cm">/* Options: Chatter [ownID [name]] */</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">ownID</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span> <span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
      <span class="o">}</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">chatterName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="k">else</span>
      <span class="o">{</span>
         <span class="n">chatterName</span> <span class="o">=</span> <span class="s">&quot;Chatter&quot;</span> <span class="o">+</span> <span class="n">ownID</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="cm">/* Initialize the NameServer attributes */</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">userID</span> <span class="o">=</span> <span class="n">ownID</span><span class="o">;</span>
      <span class="n">ns</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">chatterName</span><span class="o">;</span>

      <span class="cm">/*</span>
<span class="cm">       * Write the user-information into the system</span>
<span class="cm">       *(registering the instance implicitly)</span>
<span class="cm">       */</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">write</span> <span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">HANDLE_NIL</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.NameServiceDataWriter.write&quot;</span><span class="o">);</span>

      <span class="cm">/* Initialize the chat messages */</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">userID</span> <span class="o">=</span> <span class="n">ownID</span><span class="o">;</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">ownID</span> <span class="o">==</span> <span class="n">TERMINATION_MESSAGE</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">msg</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="s">&quot;Termination message.&quot;</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">else</span>
      <span class="o">{</span>
         <span class="n">msg</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="s">&quot;Hi there, I will send you &quot;</span> <span class="o">+</span> <span class="n">NUM_MSG</span> <span class="o">+</span> <span class="s">&quot; more messages.&quot;</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Writing message: \&quot;&quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="na">content</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="o">);</span>

      <span class="cm">/*</span>
<span class="cm">       * Register a chat message for this user (pre-allocating resources for</span>
<span class="cm">       * it!!)</span>
<span class="cm">       */</span>
      <span class="n">userHandle</span> <span class="o">=</span> <span class="n">talker</span><span class="o">.</span><span class="na">register_instance</span> <span class="o">(</span><span class="n">msg</span><span class="o">);</span>

      <span class="cm">/* Write a message using the pre-generated instance handle */</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">talker</span><span class="o">.</span><span class="na">write</span> <span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">userHandle</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.ChatMessageDataWriter.write&quot;</span><span class="o">);</span>

      <span class="cm">/* Write any number of messages */</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">NUM_MSG</span> <span class="o">&amp;&amp;</span> <span class="n">ownID</span> <span class="o">!=</span> <span class="n">TERMINATION_MESSAGE</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="o">{</span>
         <span class="k">try</span>
         <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span> <span class="o">(</span><span class="mi">1000</span><span class="o">);</span> <span class="cm">/* do not run so fast! */</span>
         <span class="o">}</span>
         <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span>
         <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span> <span class="o">();</span>
         <span class="o">}</span>
         <span class="n">msg</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
         <span class="n">msg</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="s">&quot;Message no. &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Writing message: \&quot;&quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="na">content</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="o">);</span>
         <span class="n">status</span> <span class="o">=</span> <span class="n">talker</span><span class="o">.</span><span class="na">write</span> <span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">userHandle</span><span class="o">);</span>
         <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.ChatMessageDataWriter.write&quot;</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="cm">/* Unregister the message instance for this user explicitly */</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">talker</span><span class="o">.</span><span class="na">dispose</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">userHandle</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.ChatMessageDataWriter.dispose&quot;</span><span class="o">);</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">talker</span><span class="o">.</span><span class="na">unregister_instance</span> <span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="n">userHandle</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
         <span class="s">&quot;Chat.ChatMessageDataWriter.unregister_instance&quot;</span><span class="o">);</span>

      <span class="cm">/* Leave the room */</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">unregister_instance</span><span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">HANDLE_NIL</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.NameServiceDataWriter.dispose&quot;</span><span class="o">);</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="cm">/* Stop the application */</span>
         <span class="n">ChatterApplicationWrapper</span><span class="o">.</span><span class="na">stop</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error while stopping the application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="messageboard-application">
<h3>10.1.2. MessageBoard Application<a class="headerlink" href="#messageboard-application" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span class="n">MessageBoardApplication</span><span class="o">.</span><span class="na">java</span>

<span class="cm">/************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2012 to 2016</span>
<span class="cm"> * PrismTech Ltd.</span>
<span class="cm"> * All rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * LOGICAL_NAME:    MessageBoardApplication.java</span>
<span class="cm"> * FUNCTION:        Vortex OpenSplice Modeler Tutorial example code.</span>
<span class="cm"> * MODULE:          Tutorial for the Java programming language.</span>
<span class="cm"> * DATE             January 2012.</span>
<span class="cm"> ************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * This file contains the implementation for the &#39;MessageBoardApplication&#39;</span>
<span class="cm"> * executable.</span>
<span class="cm"> *</span>
<span class="cm"> ***/</span>

<span class="kn">package</span> <span class="nn">Chat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">Chat.NamedMessageFilteredTopicWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.MessageBoardApplicationWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.MessageBoardApplicationWrapper.WrapperException</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageBoardApplication</span> <span class="kd">extends</span> <span class="n">Thread</span>
<span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="cm">/* DDS Identifiers */</span>
      <span class="n">String</span> <span class="n">ownID</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span><span class="o">;</span>

      <span class="cm">/* Options: MessageBoard [ownID] */</span>
      <span class="cm">/* Messages having owner ownID will be ignored */</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">ownID</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
      <span class="o">}</span>

      <span class="cm">/* Initialize the content filtered topics expression parameters */</span>
      <span class="k">try</span>
      <span class="o">{</span>
         <span class="n">NamedMessageFilteredTopicWrapper</span><span class="o">.</span><span class="na">setExpressionParameters</span> <span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]</span>
         <span class="o">{</span>
            <span class="n">ownID</span>
         <span class="o">});</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">NamedMessageFilteredTopicWrapper</span><span class="o">.</span><span class="na">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span>
            <span class="s">&quot;Exception occurred while setting the expression parameters:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="cm">/* Initialize the application */</span>
      <span class="k">try</span>
      <span class="o">{</span>
         <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">start</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Exception occurred while starting</span>
<span class="s">            the application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="cm">/* Create the listeners for the MessageBoard application */</span>
      <span class="n">ChatMessageDataReaderListenerImpl</span> <span class="n">chatMessageDataReaderListener</span> <span class="o">=</span>
          <span class="k">new</span> <span class="n">ChatMessageDataReaderListenerImpl</span> <span class="o">();</span>

      <span class="n">NamedMessageDataReaderListenerImpl</span> <span class="n">namedMessageDataReaderListener</span> <span class="o">=</span>
          <span class="k">new</span> <span class="n">NamedMessageDataReaderListenerImpl</span> <span class="o">();</span>

      <span class="cm">/* Print a message that the MessageBoard has opened. */</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span>
       <span class="s">&quot;MessageBoard has opened: send ChatMessage with userID = -1 to close it.&quot;</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">();</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="cm">/* Attach the ChatMessageDataReaderListener to the</span>
<span class="cm">            ChatMessageDataReader */</span>
         <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">PrivateParticipantWrapper</span>
            <span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">ChatMessageDataReaderWrapper</span><span class="o">.</span><span class="na">attach</span> <span class="o">(</span>
            <span class="n">chatMessageDataReaderListener</span><span class="o">);</span>

         <span class="cm">/*</span>
<span class="cm">          * Attach the NamedMessageDataReaderListener to the</span>
<span class="cm">          * NamedMessageDataReader</span>
<span class="cm">          */</span>
         <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">ParticipantWrapper</span><span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span>
            <span class="n">NamedMessageDataReaderWrapper</span><span class="o">.</span><span class="na">attach</span> <span class="o">(</span><span class="n">namedMessageDataReaderListener</span><span class="o">);</span>

      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Exception occured while attaching a listener:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">try</span>
         <span class="o">{</span>
            <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">stop</span> <span class="o">();</span>
         <span class="o">}</span>
         <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">eStop</span><span class="o">)</span>
         <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Exception occured while stopping application:&quot;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">eStop</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="o">}</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>


      <span class="cm">/* Wait for the ChatMessageDataReaderListener to finish */</span>
      <span class="k">while</span> <span class="o">(!</span><span class="n">chatMessageDataReaderListener</span><span class="o">.</span><span class="na">isTerminated</span> <span class="o">())</span>
      <span class="o">{</span>
         <span class="cm">/*</span>
<span class="cm">          * Sleep for some amount of time, as not to consume too much CPU</span>
<span class="cm">          * cycles.</span>
<span class="cm">          */</span>
         <span class="k">try</span>
         <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span> <span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
         <span class="o">}</span>
         <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span>
         <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span> <span class="o">();</span>
         <span class="o">}</span>
      <span class="o">}</span>

      <span class="cm">/* Wait for the NamedMessageDataReaderListener to finish */</span>
      <span class="k">while</span> <span class="o">(!</span><span class="n">namedMessageDataReaderListener</span><span class="o">.</span><span class="na">isTerminated</span> <span class="o">())</span>
      <span class="o">{</span>
         <span class="cm">/*</span>
<span class="cm">          * Sleep for some amount of time, as not to consume too much CPU</span>
<span class="cm">          * cycles.</span>
<span class="cm">          */</span>
         <span class="k">try</span>
         <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span> <span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
         <span class="o">}</span>
         <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span>
         <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span> <span class="o">();</span>
         <span class="o">}</span>
      <span class="o">}</span>

      <span class="cm">/* Print a message that the MessageBoard has terminated */</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Termination message received: exiting...&quot;</span><span class="o">);</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="cm">/* Detach the ChatMessageDataReaderListener to ChatMessageDataReader */</span>
         <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">PrivateParticipantWrapper</span>
            <span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">ChatMessageDataReaderWrapper</span><span class="o">.</span><span class="na">detach</span> <span class="o">(</span>
            <span class="n">chatMessageDataReaderListener</span><span class="o">);</span>

         <span class="cm">/*</span>
<span class="cm">          * Detach the NamedMessageDataReaderListener to the</span>
<span class="cm">          * NamedMessageDataReader</span>
<span class="cm">          */</span>
         <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">ParticipantWrapper</span><span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span>
            <span class="n">NamedMessageDataReaderWrapper</span><span class="o">.</span><span class="na">detach</span> <span class="o">(</span><span class="n">namedMessageDataReaderListener</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Exception occurred while detaching the listeners:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
      <span class="o">}</span>

      <span class="cm">/* Cleanup listener */</span>
      <span class="n">chatMessageDataReaderListener</span><span class="o">.</span><span class="na">cleanup</span> <span class="o">();</span>

      <span class="cm">/* Stop the application */</span>
      <span class="k">try</span>
      <span class="o">{</span>
         <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">stop</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Exception occurred while stopping application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
      <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="chatmessagedatareaderlistenerimpl-java">
<h4>10.1.2.1. ChatMessageDataReaderListenerImpl.java<a class="headerlink" href="#chatmessagedatareaderlistenerimpl-java" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ChatMessageDataReaderListenerImpl</span><span class="o">.</span><span class="na">java</span>

<span class="cm">/************************************************************************</span>
<span class="cm"> * Copyright (c) 2012 to 2016 PrismTech Ltd. All rights Reserved.</span>
<span class="cm"> * LOGICAL_NAME: ChatMessageDataReaderListenerImpl.java</span>
<span class="cm"> * FUNCTION:     Vortex OpenSplice Modeler Tutorial example code</span>
<span class="cm"> * MODULE:       Tutorial for the Java programming language</span>
<span class="cm"> * DATE:         January 2012</span>
<span class="cm"> * This file contains the implementation for the &#39;MessageBoard&#39; executable</span>
<span class="cm"> ***/</span>

<span class="kn">package</span> <span class="nn">Chat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">Chat.ChatMessageDataReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.ChatMessageSeqHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NameServiceDataReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NameServiceSeqHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NamedMessage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NamedMessageDataWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.ANY_INSTANCE_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.ANY_SAMPLE_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.ANY_VIEW_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.DataReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.HANDLE_NIL</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.LENGTH_UNLIMITED</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.QueryCondition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.RETCODE_NO_DATA</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.ReadCondition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.SampleInfoSeqHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.MessageBoardApplicationWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.MessageBoardApplicationWrapper.ChatMessageDataReaderListener</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChatMessageDataReaderListenerImpl</span> <span class="kd">extends</span>
<span class="n">ChatMessageDataReaderListener</span>
<span class="o">{</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TERMINATION_MESSAGE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>

   <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isTerminated</span><span class="o">;</span>

   <span class="cm">/* Generic DDS entities */</span>
   <span class="kd">private</span> <span class="n">QueryCondition</span> <span class="n">nameFinder</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">ReadCondition</span> <span class="n">newMessages</span><span class="o">;</span>

   <span class="cm">/* Type-specific DDS entities */</span>
   <span class="kd">private</span> <span class="n">ChatMessageDataReader</span> <span class="n">chatMsgReader</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">NameServiceDataReader</span> <span class="n">nameServiceReader</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">NamedMessageDataWriter</span> <span class="n">namedMessageWriter</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">ChatMessageSeqHolder</span> <span class="n">chatMsgSeq</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">SampleInfoSeqHolder</span> <span class="n">chatMsgInfoSeq</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">NameServiceSeqHolder</span> <span class="n">nameServiceSeq</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">SampleInfoSeqHolder</span> <span class="n">nameServiceInfoSeq</span><span class="o">;</span>

   <span class="cm">/* Others */</span>
   <span class="kd">private</span> <span class="n">String</span> <span class="n">nameFinderExpr</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">nameFinderParams</span><span class="o">;</span>

   <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

   <span class="kd">private</span> <span class="kt">int</span> <span class="n">previousID</span><span class="o">;</span>

   <span class="cm">/* DDS Identifiers */</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>

   <span class="cm">/* Sample definitions */</span>
   <span class="n">NamedMessage</span> <span class="n">namedMsg</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">ChatMessageDataReaderListenerImpl</span> <span class="o">()</span>
   <span class="o">{</span>
      <span class="cm">/* Initialize termination flag */</span>
      <span class="n">setTerminated</span> <span class="o">(</span><span class="kc">false</span><span class="o">);</span>

      <span class="cm">/* Type-specific DDS entities */</span>
      <span class="n">chatMsgReader</span> <span class="o">=</span> <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">PrivateParticipantWrapper</span>
         <span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">ChatMessageDataReaderWrapper</span><span class="o">.</span><span class="na">getDataReader</span> <span class="o">();</span>
      <span class="n">nameServiceReader</span> <span class="o">=</span> <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">PrivateParticipantWrapper</span>
         <span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">NameServiceDataReaderWrapper</span><span class="o">.</span><span class="na">getDataReader</span> <span class="o">();</span>
      <span class="n">namedMessageWriter</span> <span class="o">=</span> <span class="n">MessageBoardApplicationWrapper</span>
         <span class="o">.</span><span class="na">PrivateParticipantWrapper</span><span class="o">.</span><span class="na">PublisherWrapper</span><span class="o">.</span><span class="na">NamedMessageDataWriterWrapper</span>
         <span class="o">.</span><span class="na">getDataWriter</span> <span class="o">();</span>
      <span class="n">chatMsgSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ChatMessageSeqHolder</span> <span class="o">();</span>
      <span class="n">chatMsgInfoSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleInfoSeqHolder</span> <span class="o">();</span>
      <span class="n">nameServiceSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NameServiceSeqHolder</span> <span class="o">();</span>
      <span class="n">nameServiceInfoSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleInfoSeqHolder</span> <span class="o">();</span>

      <span class="cm">/* Others */</span>
      <span class="n">nameFinderExpr</span> <span class="o">=</span> <span class="s">&quot;userID = %0&quot;</span><span class="o">;</span>
      <span class="n">nameFinderParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span>
      <span class="o">{</span>
         <span class="s">&quot;0&quot;</span>
      <span class="o">};</span>
      <span class="n">userName</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
      <span class="n">previousID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>

      <span class="cm">/* Sample definitions */</span>
      <span class="n">namedMsg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedMessage</span> <span class="o">();</span>

      <span class="cm">/*</span>
<span class="cm">       * Create a QueryCondition that will look up the userName for a</span>
<span class="cm">       * specified userID</span>
<span class="cm">       */</span>
      <span class="n">nameFinder</span> <span class="o">=</span> <span class="n">nameServiceReader</span><span class="o">.</span><span class="na">create_querycondition</span> <span class="o">(</span>
         <span class="n">ANY_SAMPLE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">ANY_VIEW_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">ANY_INSTANCE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
         <span class="n">nameFinderExpr</span><span class="o">,</span> <span class="n">nameFinderParams</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkHandle</span> <span class="o">(</span><span class="n">nameFinder</span><span class="o">,</span>
         <span class="s">&quot;Chat.NameServiceDataReader.create_querycondition&quot;</span><span class="o">);</span>

      <span class="n">newMessages</span> <span class="o">=</span> <span class="n">chatMsgReader</span><span class="o">.</span><span class="na">create_readcondition</span> <span class="o">(</span><span class="n">ANY_SAMPLE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
         <span class="n">ANY_VIEW_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">ANY_INSTANCE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkHandle</span> <span class="o">(</span><span class="n">newMessages</span><span class="o">,</span>
         <span class="s">&quot;Chat.ChatMessageDataReader.create_readcondition&quot;</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">on_data_available</span><span class="o">(</span><span class="n">DataReader</span> <span class="n">dataReader</span><span class="o">)</span> <span class="o">{</span>
      <span class="cm">/* Ignore new data if termination message already received */</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">isTerminated</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="kt">boolean</span> <span class="n">terminationReceived</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">dataReader</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">chatMsgReader</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">status</span> <span class="o">=</span> <span class="n">chatMsgReader</span><span class="o">.</span><span class="na">take_w_condition</span><span class="o">(</span><span class="n">chatMsgSeq</span><span class="o">,</span> <span class="n">chatMsgInfoSeq</span><span class="o">,</span>
               <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">newMessages</span><span class="o">);</span>
         <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span>
               <span class="s">&quot;Chat.ChatMessageDataReader.take_w_condition&quot;</span><span class="o">);</span>

         <span class="cm">/*</span>
<span class="cm">          * For each message, extract the key-field and find the</span>
<span class="cm">          * corresponding name</span>
<span class="cm">          */</span>
         <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">chatMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="cm">/*</span>
<span class="cm">             * Set program termination flag if termination message is</span>
<span class="cm">             * received</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">chatMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">userID</span> <span class="o">==</span> <span class="n">TERMINATION_MESSAGE</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">terminationReceived</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
               <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="cm">/* Find the corresponding named message */</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">chatMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">userID</span> <span class="o">!=</span> <span class="n">previousID</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">previousID</span> <span class="o">=</span> <span class="n">chatMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">userID</span><span class="o">;</span>
               <span class="n">nameFinderParams</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">previousID</span><span class="o">);</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">nameFinder</span><span class="o">.</span><span class="na">set_query_parameters</span><span class="o">(</span><span class="n">nameFinderParams</span><span class="o">);</span>
               <span class="n">ErrorHandler</span>
                     <span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span>
                        <span class="s">&quot;QueryCondition.set_query_arguments (nameFinderParams)&quot;</span><span class="o">);</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">nameServiceReader</span><span class="o">.</span><span class="na">read_w_condition</span><span class="o">(</span><span class="n">nameServiceSeq</span><span class="o">,</span>
                     <span class="n">nameServiceInfoSeq</span><span class="o">,</span> <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
                     <span class="n">nameFinder</span><span class="o">);</span>
               <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span>
                     <span class="s">&quot;Chat.NameServiceDataReader.read_w_condition&quot;</span><span class="o">);</span>

               <span class="cm">/* Extract Name (there should only be one result) */</span>
               <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">RETCODE_NO_DATA</span><span class="o">.</span><span class="na">value</span><span class="o">)</span> <span class="o">{</span>
                  <span class="n">userName</span> <span class="o">=</span> <span class="s">&quot;Name not found!! id = &quot;</span> <span class="o">+</span> <span class="n">previousID</span><span class="o">;</span>
               <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                  <span class="n">userName</span> <span class="o">=</span> <span class="n">nameServiceSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">name</span><span class="o">;</span>
               <span class="o">}</span>

               <span class="cm">/* Release the name sample again */</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">nameServiceReader</span><span class="o">.</span><span class="na">return_loan</span><span class="o">(</span><span class="n">nameServiceSeq</span><span class="o">,</span>
                     <span class="n">nameServiceInfoSeq</span><span class="o">);</span>
               <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span>
                     <span class="s">&quot;Chat.NameServiceDataReader.return_loan&quot;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="cm">/* Write merged Topic with userName instead of userID */</span>
            <span class="n">namedMsg</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
            <span class="n">namedMsg</span><span class="o">.</span><span class="na">userID</span> <span class="o">=</span> <span class="n">previousID</span><span class="o">;</span>
            <span class="n">namedMsg</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="n">chatMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">index</span><span class="o">;</span>
            <span class="n">namedMsg</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">chatMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">content</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">chatMsgInfoSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">valid_data</span><span class="o">)</span>
            <span class="o">{</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">namedMessageWriter</span><span class="o">.</span><span class="na">write</span> <span class="o">(</span><span class="n">namedMsg</span><span class="o">,</span> <span class="n">HANDLE_NIL</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
               <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                  <span class="s">&quot;Chat.NamedMessageDataWriter.write&quot;</span><span class="o">);</span>
            <span class="o">}</span>
         <span class="o">}</span>

         <span class="n">status</span> <span class="o">=</span> <span class="n">chatMsgReader</span><span class="o">.</span><span class="na">return_loan</span><span class="o">(</span><span class="n">chatMsgSeq</span><span class="o">,</span> <span class="n">chatMsgInfoSeq</span><span class="o">);</span>
         <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span>
               <span class="s">&quot;Chat.ChatMessageDataReader.return_loan&quot;</span><span class="o">);</span>

         <span class="k">if</span> <span class="o">(</span><span class="n">terminationReceived</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setTerminated</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
         <span class="o">}</span>
      <span class="o">}</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanup</span> <span class="o">()</span>
   <span class="o">{</span>
      <span class="cm">/* Remove all Read Conditions from the DataReaders */</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">nameServiceReader</span><span class="o">.</span><span class="na">delete_readcondition</span> <span class="o">(</span><span class="n">nameFinder</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.NameServiceDataReader</span>
<span class="s">      .delete_readcondition(nameFinder)&quot;</span><span class="o">);</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">chatMsgReader</span><span class="o">.</span><span class="na">delete_readcondition</span> <span class="o">(</span><span class="n">newMessages</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.ChatMessageDataReader</span>
<span class="s">      .delete_readcondition(newMessages)&quot;</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">isTerminated</span> <span class="o">()</span>
   <span class="o">{</span>
      <span class="k">return</span> <span class="n">isTerminated</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">setTerminated</span> <span class="o">(</span><span class="kt">boolean</span> <span class="n">isTerminated</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isTerminated</span> <span class="o">=</span> <span class="n">isTerminated</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="namedmessagedatareaderlistenerimpl-java">
<h4>10.1.2.2. NamedMessageDataReaderListenerImpl.java<a class="headerlink" href="#namedmessagedatareaderlistenerimpl-java" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java"><div class="highlight"><pre><span class="n">NamedMessageDataReaderListenerImpl</span><span class="o">.</span><span class="na">java</span>

<span class="cm">/************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2012 to 2016</span>
<span class="cm"> * PrismTech Ltd.</span>
<span class="cm"> * All rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * LOGICAL_NAME:    NamedMessageDataReaderListenerImpl.java</span>
<span class="cm"> * FUNCTION:        Vortex OpenSplice Modeler Tutorial example code.</span>
<span class="cm"> * MODULE:          Tutorial for the Java programming language.</span>
<span class="cm"> * DATE             January 2012.</span>
<span class="cm"> ************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * This file contains the implementation for the &#39;MessageBoard&#39; executable.</span>
<span class="cm"> *</span>
<span class="cm"> ***/</span>

<span class="kn">package</span> <span class="nn">Chat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">Chat.NamedMessageDataReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.NamedMessageSeqHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.ALIVE_INSTANCE_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.ANY_VIEW_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.DataReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.LENGTH_UNLIMITED</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.NOT_READ_SAMPLE_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.SampleInfoSeqHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.MessageBoardApplicationWrapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">Chat.MessageBoardApplicationWrapper.NamedMessageDataReaderListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NamedMessageDataReaderListenerImpl</span> <span class="kd">extends</span>
      <span class="n">NamedMessageDataReaderListener</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isTerminated</span><span class="o">;</span>

   <span class="cm">/* DDS Identifiers */</span>
   <span class="kd">private</span> <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>

   <span class="cm">/* Type-specific DDS entities */</span>
   <span class="kd">private</span> <span class="n">NamedMessageDataReader</span> <span class="n">namedMsgReader</span><span class="o">;</span>
   <span class="kd">private</span> <span class="n">NamedMessageSeqHolder</span> <span class="n">namedMsgSeq</span><span class="o">;</span>
   <span class="kd">private</span> <span class="n">SampleInfoSeqHolder</span> <span class="n">infoSeq</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">NamedMessageDataReaderListenerImpl</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">namedMsgReader</span> <span class="o">=</span> <span class="n">MessageBoardApplicationWrapper</span><span class="o">.</span><span class="na">ParticipantWrapper</span>
         <span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">NamedMessageDataReaderWrapper</span>
         <span class="o">.</span><span class="na">getDataReader</span><span class="o">();</span>
      <span class="n">namedMsgSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedMessageSeqHolder</span><span class="o">();</span>
      <span class="n">infoSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleInfoSeqHolder</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">on_data_available</span><span class="o">(</span><span class="n">DataReader</span> <span class="n">dataReader</span><span class="o">)</span> <span class="o">{</span>
      <span class="cm">/* Set termination flag */</span>
      <span class="n">setTerminated</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

      <span class="n">status</span> <span class="o">=</span> <span class="n">namedMsgReader</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="n">namedMsgSeq</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">,</span>
            <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">NOT_READ_SAMPLE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
            <span class="n">ANY_VIEW_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">ALIVE_INSTANCE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.NamedMessageDataReader.read&quot;</span><span class="o">);</span>

      <span class="cm">/* For each message, print the message */</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">namedMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">namedMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">userName</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span>
               <span class="o">+</span> <span class="n">namedMsgSeq</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">content</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="n">status</span> <span class="o">=</span> <span class="n">namedMsgReader</span><span class="o">.</span><span class="na">return_loan</span><span class="o">(</span><span class="n">namedMsgSeq</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span><span class="o">(</span><span class="n">status</span><span class="o">,</span>
            <span class="s">&quot;Chat.NamedMessageDataReader.return_loan&quot;</span><span class="o">);</span>

      <span class="n">namedMsgSeq</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="n">infoSeq</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="cm">/* Unset termination flag */</span>
      <span class="n">setTerminated</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">isTerminated</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">isTerminated</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">setTerminated</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isTerminated</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isTerminated</span> <span class="o">=</span> <span class="n">isTerminated</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="userload-application">
<h3>10.1.3. UserLoad Application<a class="headerlink" href="#userload-application" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span class="n">UserLoadApplication</span><span class="o">.</span><span class="na">java</span>

<span class="cm">/*******************************************************************************</span>

<span class="cm"> * Copyright (c) 2012 to 2016</span>
<span class="cm"> * PrismTech Ltd.</span>
<span class="cm"> * All rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * LOGICAL_NAME: UserLoadApplication.java</span>
<span class="cm"> * FUNCTION:     Vortex OpenSplice Modeler Tutorial example code.</span>
<span class="cm"> * MODULE:       Tutorial for the Java programming language.</span>
<span class="cm"> * DATE          January 2012.</span>
<span class="cm"> * ***********************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * This file contains the implementation for the &#39;UserLoadApplication&#39; executable.</span>
<span class="cm"> *</span>
<span class="cm"> ******************************************************************************/</span>

<span class="kn">package</span> <span class="nn">Chat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">Chat.UserLoadApplicationWrapper.WrapperException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLoadApplication</span> <span class="kd">extends</span> <span class="n">Thread</span>
<span class="o">{</span>
   <span class="cm">/* entities required by all threads */</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="n">GuardCondition</span> <span class="n">escape</span><span class="o">;</span>

   <span class="cm">/**</span>
<span class="cm">    * Sleeper thread: sleeps 60 seconds and then triggers the WaitSet</span>
<span class="cm">    */</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span> <span class="o">()</span>
   <span class="o">{</span>
      <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="n">sleep</span> <span class="o">(</span><span class="mi">60000</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">escape</span><span class="o">.</span><span class="na">set_trigger_value</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;DDS.GuardCondition.set_trigger_value&quot;</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
   <span class="o">{</span>

      <span class="kt">boolean</span> <span class="n">closed</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="kt">int</span> <span class="n">prevCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="cm">/* Initialize the application */</span>
         <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">start</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error while starting the application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="cm">/* Initialize the arguments and params for the QueryCondition */</span>
      <span class="n">String</span><span class="o">[]</span> <span class="n">params</span><span class="o">;</span>

      <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span>
      <span class="o">{</span>
         <span class="s">&quot;0&quot;</span>
      <span class="o">};</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">QueryConditionWrapper</span><span class="o">.</span><span class="na">setQueryParameters</span> <span class="o">(</span>
            <span class="n">params</span><span class="o">);</span>

         <span class="cm">/* start the ChatMessageDataReaderWaitSet */</span>
         <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">UserLoadWaitSetWrapper</span><span class="o">.</span><span class="na">start</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error while initializing the application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="n">WaitSet</span> <span class="n">userLoadWS</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">UserLoadWaitSetWrapper</span>
         <span class="o">.</span><span class="na">getWaitSet</span> <span class="o">();</span>

      <span class="cm">/* Generic DDS entities */</span>
      <span class="n">escape</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">GuardConditionWrapper</span>
         <span class="o">.</span><span class="na">getGuardCondition</span> <span class="o">();</span>
      <span class="n">QueryCondition</span> <span class="n">singleUser</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span>
         <span class="o">.</span><span class="na">QueryConditionWrapper</span><span class="o">.</span><span class="na">getQueryCondition</span> <span class="o">();</span>
      <span class="n">ReadCondition</span> <span class="n">newUser</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">ReadConditionWrapper</span>
         <span class="o">.</span><span class="na">getReadCondition</span> <span class="o">();</span>
      <span class="n">StatusCondition</span> <span class="n">leftUser</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">StatusConditionWrapper</span>
         <span class="o">.</span><span class="na">getStatusCondition</span> <span class="o">();</span>

      <span class="n">LivelinessChangedStatusHolder</span> <span class="n">livChangedStatusHolder</span> <span class="o">=</span> <span class="k">new</span>
         <span class="n">LivelinessChangedStatusHolder</span> <span class="o">();</span>

      <span class="cm">/* DDS Identifiers */</span>
      <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>
      <span class="n">ConditionSeqHolder</span> <span class="n">guardList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConditionSeqHolder</span> <span class="o">();</span>

      <span class="cm">/* Type-specific DDS entities */</span>
      <span class="n">NameServiceDataReader</span> <span class="n">nameServer</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span>
         <span class="o">.</span><span class="na">ParticipantWrapper</span><span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">NameServiceDataReaderWrapper</span>
         <span class="o">.</span><span class="na">getDataReader</span> <span class="o">();</span>
      <span class="n">ChatMessageDataReader</span> <span class="n">loadAdmin</span> <span class="o">=</span> <span class="n">UserLoadApplicationWrapper</span>
         <span class="o">.</span><span class="na">ParticipantWrapper</span><span class="o">.</span><span class="na">SubscriberWrapper</span><span class="o">.</span><span class="na">ChatMessageDataReaderWrapper</span>
         <span class="o">.</span><span class="na">getDataReader</span> <span class="o">();</span>
      <span class="n">ChatMessageSeqHolder</span> <span class="n">msgList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ChatMessageSeqHolder</span> <span class="o">();</span>
      <span class="n">NameServiceSeqHolder</span> <span class="n">nsList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NameServiceSeqHolder</span> <span class="o">();</span>
      <span class="n">SampleInfoSeqHolder</span> <span class="n">infoSeq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleInfoSeqHolder</span> <span class="o">();</span>
      <span class="n">SampleInfoSeqHolder</span> <span class="n">infoSeq2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleInfoSeqHolder</span> <span class="o">();</span>

      <span class="cm">/*</span>
<span class="cm">       * Initialize and pre-allocate the GuardList used to obtain the triggered</span>
<span class="cm">       * Conditions.</span>
<span class="cm">       */</span>
      <span class="n">guardList</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Condition</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>

      <span class="cm">/* Remove all known Users that are not currently active. */</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">take</span> <span class="o">(</span><span class="n">nsList</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">,</span> <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
         <span class="n">ANY_SAMPLE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">ANY_VIEW_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
         <span class="n">NOT_ALIVE_INSTANCE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.NameServiceDataReader.take&quot;</span><span class="o">);</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">return_loan</span> <span class="o">(</span><span class="n">nsList</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">);</span>
      <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;Chat.NameServiceDataReader.return_loan&quot;</span><span class="o">);</span>

      <span class="cm">/* Start the sleeper thread */</span>
      <span class="k">new</span> <span class="n">UserLoadApplication</span> <span class="o">().</span><span class="na">start</span> <span class="o">();</span>

      <span class="k">while</span> <span class="o">(!</span><span class="n">closed</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="cm">/* Wait until at least one of the Conditions in the waitset triggers */</span>
         <span class="n">status</span> <span class="o">=</span> <span class="n">userLoadWS</span><span class="o">.</span><span class="na">_wait</span> <span class="o">(</span><span class="n">guardList</span><span class="o">,</span> <span class="n">DURATION_INFINITE</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
         <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="s">&quot;DDS.WaitSet._wait&quot;</span><span class="o">);</span>

         <span class="cm">/* Walk over all the guards to display information */</span>
         <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">guardList</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
         <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">guardList</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="n">newUser</span><span class="o">)</span>
            <span class="o">{</span>
               <span class="cm">/* The newUser ReadCondition contains data */</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">read_w_condition</span> <span class="o">(</span><span class="n">nsList</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">,</span>
                  <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">newUser</span><span class="o">);</span>
               <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                  <span class="s">&quot;Chat.NameServiceDataReader.read_w_condition&quot;</span><span class="o">);</span>

               <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nsList</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
               <span class="o">{</span>
                  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;New User: &quot;</span> <span class="o">+</span> <span class="n">nsList</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">name</span><span class="o">);</span>
               <span class="o">}</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">return_loan</span> <span class="o">(</span><span class="n">nsList</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">);</span>
               <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                  <span class="s">&quot;Chat.NameServiceDataReader.return_loan&quot;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">guardList</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="n">leftUser</span><span class="o">)</span>
            <span class="o">{</span>
               <span class="cm">/*</span>
<span class="cm">                * Some liveliness has changed (either because a DataWriter</span>
<span class="cm">                * joined or a DataWriter left</span>
<span class="cm">                */</span>
               <span class="n">status</span> <span class="o">=</span> <span class="n">loadAdmin</span><span class="o">.</span><span class="na">get_liveliness_changed_status</span> <span class="o">(</span>
                  <span class="n">livChangedStatusHolder</span><span class="o">);</span>
               <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                  <span class="s">&quot;Chat.ChatMessageDataReader.get_liveliness_changed_status&quot;</span><span class="o">);</span>

               <span class="k">if</span> <span class="o">(</span><span class="n">livChangedStatusHolder</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">alive_count</span> <span class="o">&lt;</span> <span class="n">prevCount</span><span class="o">)</span>
               <span class="o">{</span>
                  <span class="cm">/*</span>
<span class="cm">                   * A user has left the ChatRoom, since a DataWriter lost its</span>
<span class="cm">                   * liveliness</span>
<span class="cm">                   */</span>
                  <span class="cm">/*</span>
<span class="cm">                   * Take the effected users so they will not appear in the list</span>
<span class="cm">                   * later on</span>
<span class="cm">                   */</span>
                  <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">take</span> <span class="o">(</span><span class="n">nsList</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">,</span>
                     <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">ANY_SAMPLE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span>
                     <span class="n">ANY_VIEW_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">NOT_ALIVE_INSTANCE_STATE</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
                  <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                     <span class="s">&quot;Chat.NameServiceDataReader.take&quot;</span><span class="o">);</span>

                  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nsList</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                  <span class="o">{</span>
                     <span class="cm">/* re-apply query arguments */</span>
                     <span class="n">params</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span> <span class="o">(</span><span class="n">nsList</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">userID</span><span class="o">);</span>
                     <span class="n">status</span> <span class="o">=</span> <span class="n">singleUser</span><span class="o">.</span><span class="na">set_query_parameters</span> <span class="o">(</span><span class="n">params</span><span class="o">);</span>
                     <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                        <span class="s">&quot;DDS.QueryCondition.set_query_arguments&quot;</span><span class="o">);</span>

                     <span class="cm">/* Read this users history */</span>
                     <span class="n">status</span> <span class="o">=</span> <span class="n">loadAdmin</span><span class="o">.</span><span class="na">take_w_condition</span> <span class="o">(</span><span class="n">msgList</span><span class="o">,</span> <span class="n">infoSeq2</span><span class="o">,</span>
                        <span class="n">LENGTH_UNLIMITED</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">singleUser</span><span class="o">);</span>
                     <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                        <span class="s">&quot;Chat.ChatMessageDataReader.read_w_condition&quot;</span><span class="o">);</span>

                     <span class="cm">/* Display the user and his history */</span>
                     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Departed user &quot;</span> <span class="o">+</span> <span class="n">nsList</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">name</span> <span class="o">+</span>
                         <span class="s">&quot; had sent &quot;</span> <span class="o">+</span> <span class="n">msgList</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="s">&quot; messages.&quot;</span><span class="o">);</span>
                     <span class="n">status</span> <span class="o">=</span> <span class="n">loadAdmin</span><span class="o">.</span><span class="na">return_loan</span> <span class="o">(</span><span class="n">msgList</span><span class="o">,</span> <span class="n">infoSeq2</span><span class="o">);</span>
                     <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                        <span class="s">&quot;Chat.ChatMessageDataReader.return_loan&quot;</span><span class="o">);</span>
                     <span class="n">msgList</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                     <span class="n">infoSeq2</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                  <span class="o">}</span>
                  <span class="n">status</span> <span class="o">=</span> <span class="n">nameServer</span><span class="o">.</span><span class="na">return_loan</span> <span class="o">(</span><span class="n">nsList</span><span class="o">,</span> <span class="n">infoSeq</span><span class="o">);</span>
                  <span class="n">ErrorHandler</span><span class="o">.</span><span class="na">checkStatus</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span>
                     <span class="s">&quot;Chat.NameServiceDataReader.return_loan&quot;</span><span class="o">);</span>
                  <span class="n">nsList</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                  <span class="n">infoSeq</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
               <span class="o">}</span>
               <span class="n">prevCount</span> <span class="o">=</span> <span class="n">livChangedStatusHolder</span><span class="o">.</span><span class="na">value</span><span class="o">.</span><span class="na">alive_count</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">guardList</span><span class="o">.</span><span class="na">value</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="n">escape</span><span class="o">)</span>
            <span class="o">{</span>
               <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;UserLoad has terminated.&quot;</span><span class="o">);</span>
               <span class="n">closed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">else</span>
            <span class="o">{</span>
               <span class="k">assert</span> <span class="kc">false</span> <span class="o">:</span> <span class="s">&quot;Unknown Condition&quot;</span><span class="o">;</span>
            <span class="o">}</span>
         <span class="o">}</span> <span class="cm">/* for */</span>
      <span class="o">}</span> <span class="cm">/* while (!closed) */</span>

      <span class="k">try</span>
      <span class="o">{</span>
         <span class="cm">/* Stop the application and free all resources */</span>
         <span class="n">UserLoadApplicationWrapper</span><span class="o">.</span><span class="na">stop</span> <span class="o">();</span>
      <span class="o">}</span>
      <span class="k">catch</span> <span class="o">(</span><span class="n">WrapperException</span> <span class="n">e</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error while stopping the application:&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getReason</span> <span class="o">());</span>
         <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="error-handler">
<h3>10.1.4. Error Handler<a class="headerlink" href="#error-handler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ErrorHandler</span><span class="o">.</span><span class="na">java</span>

<span class="cm">/************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2012 to 2016</span>
<span class="cm"> * PrismTech Ltd.</span>
<span class="cm"> * All rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * LOGICAL_NAME: ErrorHandler.java</span>
<span class="cm"> * FUNCTION: Vortex OpenSplice Modeler Tutorial example code.</span>
<span class="cm"> * MODULE: Tutorial for the Java programming language.</span>
<span class="cm"> * DATE: January 2012.</span>
<span class="cm"> ************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * This file contains the implementation for the error handling operations.</span>
<span class="cm"> *</span>
<span class="cm"> ***/</span>

<span class="kn">package</span> <span class="nn">Chatroom</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">DDS.RETCODE_NO_DATA</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">DDS.RETCODE_OK</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorHandler</span>
<span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">NR_ERROR_CODES</span> <span class="o">=</span> <span class="mi">12</span><span class="o">;</span>

   <span class="cm">/* Array to hold the names for all ReturnCodes. */</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">RetCodeName</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">NR_ERROR_CODES</span><span class="o">];</span>

   <span class="kd">static</span>
   <span class="o">{</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_OK&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_ERROR&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_UNSUPPORTED&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_BAD_PARAMETER&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_PRECONDITION_NOT_MET&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_OUT_OF_RESOURCES&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_NOT_ENABLED&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_IMMUTABLE_POLICY&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">8</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_INCONSISTENT_POLICY&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">9</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_ALREADY_DELETED&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">10</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_TIMEOUT&quot;</span><span class="o">);</span>
      <span class="n">RetCodeName</span><span class="o">[</span><span class="mi">11</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span> <span class="o">(</span><span class="s">&quot;DDS_RETCODE_NO_DATA&quot;</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**</span>
<span class="cm">    * Returns the name of an error code.</span>
<span class="cm">    */</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getErrorName</span> <span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="k">return</span> <span class="n">RetCodeName</span><span class="o">[</span><span class="n">status</span><span class="o">];</span>
   <span class="o">}</span>

   <span class="cm">/**</span>
<span class="cm">    * Check the return status for errors. If there is an error, then terminate.</span>
<span class="cm">    */</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">checkStatus</span> <span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">,</span> <span class="n">String</span> <span class="n">info</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">RETCODE_OK</span><span class="o">.</span><span class="na">value</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">RETCODE_NO_DATA</span><span class="o">.</span><span class="na">value</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error in &quot;</span> <span class="o">+</span> <span class="n">info</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">getErrorName</span> <span class="o">(</span><span class="n">status</span><span class="o">));</span>
         <span class="n">System</span><span class="o">.</span><span class="na">exit</span> <span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
      <span class="o">}</span>
   <span class="o">}</span>

   <span class="cm">/**</span>
<span class="cm">    * Check whether a valid handle has been returned. If not, then terminate.</span>
<span class="cm">    */</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">checkHandle</span> <span class="o">(</span><span class="n">Object</span> <span class="n">handle</span><span class="o">,</span> <span class="n">String</span> <span class="n">info</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">handle</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="o">{</span>
         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s">&quot;Error in &quot;</span> <span class="o">+</span> <span class="n">info</span> <span class="o">+</span>
            <span class="s">&quot;: Creation failed: invalid handle&quot;</span><span class="o">);</span>
         <span class="n">System</span><span class="o">.</span><span class="na">exit</span> <span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
      <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/Vortex_logo_2014.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">10. Appendix A</a><ul>
<li><a class="reference internal" href="#a-chatroom-example-java-source-code">10.1. A Chatroom Example, Java Source Code</a><ul>
<li><a class="reference internal" href="#chatter-application">10.1.1. Chatter Application</a></li>
<li><a class="reference internal" href="#messageboard-application">10.1.2. MessageBoard Application</a><ul>
<li><a class="reference internal" href="#chatmessagedatareaderlistenerimpl-java">10.1.2.1. ChatMessageDataReaderListenerImpl.java</a></li>
<li><a class="reference internal" href="#namedmessagedatareaderlistenerimpl-java">10.1.2.2. NamedMessageDataReaderListenerImpl.java</a></li>
</ul>
</li>
<li><a class="reference internal" href="#userload-application">10.1.3. UserLoad Application</a></li>
<li><a class="reference internal" href="#error-handler">10.1.4. Error Handler</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="previous chapter">9. Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="appendixb.html"
                        title="next chapter">11. Appendix B</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/appendixa.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="appendixb.html" title="11. Appendix B"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="9. Tutorial"
             >previous</a> |</li>
        <li><a href="index.html">Modeling Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, PrismTech.
    </div>
  </body>
</html>